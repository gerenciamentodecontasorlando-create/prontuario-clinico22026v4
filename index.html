<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>BTX Clinic — PWA</title>
  <meta name="theme-color" content="#0b1220" />
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icons/icon-192.png" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />
  <link rel="stylesheet" href="styles.css" />

  <!-- PDF deps (CDN) -->
  <script defer src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <script defer src="app.js"></script>
</head>
<body>
  <div id="toast" class="toast" aria-live="polite" aria-atomic="true"></div>

  <!-- TOP BAR (externo / interno) -->
  <header class="topbar">
    <div class="brand">
      <div class="brandDot"></div>
      <div class="brandText">
        <div class="brandName">BTX Clinic</div>
        <div class="brandSub">PWA Offline • Agenda • Prontuário • PDFs</div>
      </div>
    </div>

    <div class="topActions">
      <button id="installBtn" class="btn ghost" title="Instalar no aparelho" hidden>Instalar</button>
      <button id="loginBtn" class="btn primary">Login</button>
      <button id="logoutBtn" class="btn danger" hidden>Sair</button>
    </div>
  </header>

  <!-- EXTERNO (site) -->
  <main id="publicView" class="public">
    <section class="hero card">
      <div class="heroLeft">
        <div class="photoWrap">
          <img class="photo" src="assets/profile.jpg" alt="Foto profissional" onerror="this.style.opacity=.2; this.alt='(adicione assets/profile.jpg)';" />
          <div class="photoHint">Troque a foto em <b>/assets/profile.jpg</b></div>
        </div>
      </div>

      <div class="heroRight">
        <h1 id="publicName">Dr. Orlando Abreu Gomes da Silva</h1>
        <p id="publicTitle" class="muted">
          Odontologia • Cirurgia e Traumatologia Buco Maxilo Facial • Saúde Coletiva • Tecnologia
        </p>

        <div class="grid2">
          <div class="infoBox">
            <div class="label">Contato</div>
            <div id="publicPhone" class="value">(91) 99987-3835</div>
            <div id="publicPhone2" class="value">(91) 99298-0333</div>
          </div>
          <div class="infoBox">
            <div class="label">Local</div>
            <div id="publicCity" class="value">Belém • Pará • Brasil</div>
            <div id="publicEmail" class="value">orlandodentista@outlook.com</div>
          </div>
        </div>

        <div class="hr"></div>

        <div class="chips">
          <span class="chip">Agenda inteligente (sem fds/feriados)</span>
          <span class="chip">Prontuário com evolução por data</span>
          <span class="chip">Receita / Atestado / Orçamento em PDF</span>
          <span class="chip">Offline-first</span>
        </div>

        <div class="note">
          <b>Como funciona:</b> a parte interna só abre com senha. Senha inicial: <b>1212</b>.  
          Você troca em <b>Configurações</b>.
        </div>
      </div>
    </section>

    <section class="card">
      <h2>Área pública (site)</h2>
      <p class="muted">
        Você pode editar seus dados públicos em <b>Configurações</b> depois do login.
        A ideia é parecer um site profissional por fora — e um sistema robusto por dentro.
      </p>
    </section>
  </main>

  <!-- INTERNO (app) -->
  <main id="appView" class="app" hidden>
    <div class="layout">
      <aside class="sidebar card">
        <div class="sideHeader">
          <div class="sideTitle">Painel</div>
          <div class="sideSub muted">Tudo offline no aparelho</div>
        </div>

        <nav class="nav">
          <button class="navBtn active" data-tab="dashboard">Visão geral</button>
          <button class="navBtn" data-tab="calendar">Agenda</button>
          <button class="navBtn" data-tab="patients">Pacientes</button>
          <button class="navBtn" data-tab="records">Ficha clínica</button>
          <button class="navBtn" data-tab="docs">Documentos & PDFs</button>
          <button class="navBtn" data-tab="settings">Configurações</button>
        </nav>

        <div class="sideFooter muted">
          <div><b>Login:</b> senha local</div>
          <div><b>Dados:</b> IndexedDB</div>
        </div>
      </aside>

      <section class="content">
        <!-- DASHBOARD -->
        <section class="panel card" data-panel="dashboard">
          <div class="panelHeader">
            <h2>Visão geral</h2>
            <div class="muted" id="dashToday"></div>
          </div>

          <div class="grid3">
            <div class="kpi">
              <div class="kpiLabel">Pacientes</div>
              <div class="kpiValue" id="kpiPatients">0</div>
            </div>
            <div class="kpi">
              <div class="kpiLabel">Agendamentos (mês)</div>
              <div class="kpiValue" id="kpiMonthAppts">0</div>
            </div>
            <div class="kpi">
              <div class="kpiLabel">Últimas evoluções</div>
              <div class="kpiValue" id="kpiRecentNotes">0</div>
            </div>
          </div>

          <div class="grid2 mt">
            <div class="card inner">
              <h3>Próximos agendamentos</h3>
              <div id="dashNextAppts" class="list muted">—</div>
            </div>
            <div class="card inner">
              <h3>Últimos pacientes editados</h3>
              <div id="dashRecentPatients" class="list muted">—</div>
            </div>
          </div>
        </section>

        <!-- CALENDAR -->
        <section class="panel card" data-panel="calendar" hidden>
          <div class="panelHeader">
            <h2>Agenda</h2>
            <div class="row">
              <button id="calPrev" class="btn ghost">◀</button>
              <div id="calTitle" class="calTitle"></div>
              <button id="calNext" class="btn ghost">▶</button>
              <button id="calToday" class="btn ghost">Hoje</button>
            </div>
          </div>

          <div class="calLegend">
            <span class="dot ok"></span> dia útil
            <span class="dot bad"></span> bloqueado (fds/feriado)
            <span class="dot has"></span> tem agendamento
          </div>

          <div id="calendarGrid" class="calendarGrid"></div>

          <div class="hr"></div>

          <div class="grid2">
            <div class="card inner">
              <h3>Agendar</h3>
              <div class="muted small">Não agenda em sábado, domingo e feriado (configurável).</div>

              <div class="form">
                <label>Data</label>
                <input id="apptDate" type="date" />

                <label>Hora</label>
                <input id="apptTime" type="time" />

                <label>Paciente</label>
                <select id="apptPatient"></select>

                <label>Observações</label>
                <textarea id="apptNote" rows="3" placeholder="Ex.: retorno, procedimento, observações..."></textarea>

                <button id="addApptBtn" class="btn primary">Salvar agendamento</button>
              </div>
            </div>

            <div class="card inner">
              <h3>Agendamentos do dia</h3>
              <div id="dayApptsTitle" class="muted small">Selecione um dia no calendário.</div>
              <div id="dayApptsList" class="list muted">—</div>
            </div>
          </div>
        </section>

        <!-- PATIENTS -->
        <section class="panel card" data-panel="patients" hidden>
          <div class="panelHeader">
            <h2>Pacientes</h2>
            <div class="row">
              <input id="patientSearch" class="input" placeholder="Buscar por nome, telefone, CPF..." />
              <button id="newPatientBtn" class="btn primary">Novo paciente</button>
            </div>
          </div>

          <div class="grid2">
            <div class="card inner">
              <h3>Lista</h3>
              <div id="patientsList" class="list muted">—</div>
            </div>

            <div class="card inner">
              <h3>Detalhes</h3>
              <div id="patientDetail" class="muted">Selecione um paciente.</div>
            </div>
          </div>
        </section>

        <!-- RECORDS -->
        <section class="panel card" data-panel="records" hidden>
          <div class="panelHeader">
            <h2>Ficha clínica</h2>
            <div class="row">
              <select id="recordPatientSelect"></select>
              <button id="saveRecordBtn" class="btn primary">Salvar ficha</button>
            </div>
          </div>

          <div class="grid2">
            <div class="card inner">
              <h3>Anamnese</h3>
              <div class="form">
                <label>Queixa principal</label>
                <textarea id="anamneseChief" rows="2"></textarea>

                <label>História da doença atual</label>
                <textarea id="anamneseHda" rows="3"></textarea>

                <label>Antecedentes / Comorbidades</label>
                <textarea id="anamneseHx" rows="3"></textarea>

                <label>Alergias</label>
                <input id="anamneseAllergies" type="text" placeholder="Ex.: dipirona, penicilina..." />

                <label>Medicações em uso</label>
                <textarea id="anamneseMeds" rows="2"></textarea>

                <label>Sinais vitais / Observações</label>
                <textarea id="anamneseVitals" rows="2"></textarea>
              </div>
            </div>

            <div class="card inner">
              <h3>Evolução por data</h3>
              <div class="form">
                <label>Data do atendimento</label>
                <input id="visitDate" type="date" />

                <label>Procedimento / Evolução</label>
                <textarea id="visitNote" rows="6" placeholder="Descreva tudo o que foi feito, conduta, materiais, etc."></textarea>

                <button id="addVisitBtn" class="btn ghost">Adicionar evolução</button>
              </div>

              <div class="hr"></div>
              <div id="visitsList" class="list muted">—</div>
            </div>
          </div>
        </section>

        <!-- DOCS -->
        <section class="panel card" data-panel="docs" hidden>
          <div class="panelHeader">
            <h2>Documentos & PDFs</h2>
            <div class="row">
              <select id="docsPatientSelect"></select>
              <button id="refreshDocPreviewBtn" class="btn ghost">Atualizar prévia</button>
            </div>
          </div>

          <div class="grid2">
            <div class="card inner">
              <h3>Gerar documentos (individualizados)</h3>
              <div class="muted small">
                Cada botão gera <b>um PDF separado</b>. Se o texto exceder, cria novas páginas mantendo borda A4.
              </div>

              <div class="form">
                <label>Tipo de documento</label>
                <select id="docType">
                  <option value="prescription">Receituário</option>
                  <option value="certificate">Atestado</option>
                  <option value="budget">Orçamento</option>
                  <option value="clinical">Ficha clínica</option>
                </select>

                <label>Título/Assunto (opcional)</label>
                <input id="docSubject" type="text" placeholder="Ex.: Pós-operatório, Dor, Retorno..." />

                <label>Texto do documento</label>
                <textarea id="docBody" rows="10" placeholder="Digite o conteúdo completo. (Sem abreviações, do jeito que você gosta.)"></textarea>

                <div class="row wrap">
                  <button id="fillTemplateBtn" class="btn ghost">Carregar modelo rápido</button>
                  <button id="makePdfBtn" class="btn primary">Gerar PDF deste documento</button>
                </div>
              </div>
            </div>

            <div class="card inner">
              <h3>Prévia (A4)</h3>
              <div class="muted small">A prévia abaixo é o que vai pro PDF.</div>
              <div class="docPreviewWrap">
                <div id="docPreview" class="docPage"></div>
              </div>
            </div>
          </div>
        </section>

        <!-- SETTINGS -->
        <section class="panel card" data-panel="settings" hidden>
          <div class="panelHeader">
            <h2>Configurações</h2>
            <div class="muted">Dados do profissional + senha + feriados</div>
          </div>

          <div class="grid2">
            <div class="card inner">
              <h3>Dados do profissional (aparecem no topo dos PDFs)</h3>
              <div class="form">
                <label>Nome</label>
                <input id="proName" type="text" />

                <label>Registro (CRO/CRM/Outro)</label>
                <input id="proReg" type="text" placeholder="Ex.: CRO-PA 00000" />

                <label>Telefone</label>
                <input id="proPhone" type="text" />

                <label>E-mail</label>
                <input id="proEmail" type="email" />

                <label>Endereço do consultório (rodapé do PDF)</label>
                <textarea id="proAddress" rows="3"></textarea>

                <label>Texto público (site)</label>
                <textarea id="publicBio" rows="3"></textarea>

                <button id="saveProBtn" class="btn primary">Salvar dados</button>
              </div>
            </div>

            <div class="card inner">
              <h3>Senha & dias bloqueados</h3>
              <div class="form">
                <label>Senha atual</label>
                <input id="pwCurrent" type="password" inputmode="numeric" autocomplete="off" />

                <label>Nova senha</label>
                <input id="pwNew" type="password" inputmode="numeric" autocomplete="off" />

                <label>Confirmar nova senha</label>
                <input id="pwNew2" type="password" inputmode="numeric" autocomplete="off" />

                <button id="changePwBtn" class="btn danger">Trocar senha</button>

                <div class="hr"></div>

                <label>Feriados (YYYY-MM-DD), um por linha</label>
                <textarea id="holidays" rows="8" placeholder="Ex.:
2026-01-01
2026-04-21
2026-05-01"></textarea>

                <button id="saveHolidaysBtn" class="btn primary">Salvar feriados</button>

                <div class="note small">
                  <b>Regras fixas:</b> sábado e domingo já são bloqueados.  
                  <b>Feriados:</b> você controla aqui.
                </div>
              </div>
            </div>
          </div>

          <div class="hr"></div>

          <div class="row wrap">
            <button id="exportBtn" class="btn ghost">Backup (exportar dados)</button>
            <input id="importFile" type="file" accept="application/json" hidden />
            <button id="importBtn" class="btn ghost">Restaurar (importar backup)</button>
            <button id="wipeBtn" class="btn danger">Apagar tudo do aparelho</button>
          </div>
        </section>

      </section>
    </div>
  </main>

  <!-- MODAL LOGIN -->
  <div id="modal" class="modal" hidden>
    <div class="modalCard card">
      <div class="modalHeader">
        <div class="modalTitle">Login</div>
        <button id="closeModal" class="btn ghost">✕</button>
      </div>

      <div class="form">
        <label>Senha</label>
        <input id="pwInput" type="password" inputmode="numeric" autocomplete="off" placeholder="Digite a senha" />
        <button id="doLogin" class="btn primary">Entrar</button>
        <div class="muted small">
          Senha inicial: <b>1212</b> (troque depois em Configurações).
        </div>
      </div>
    </div>
  </div>

</body>
</html>
